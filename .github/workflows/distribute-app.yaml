name: Distribute app

on:
  workflow_dispatch:
    inputs:
      environment:
        description: Environment
        required: true
        type: choice
        options:
          - dev
          - stg
          - prd
  push:
    tags:
      - v[0-9]+.[0-9]+.[0-9]+
      - v[0-9]+.[0-9]+.[0-9]+-stg.[0-9]+
      - v[0-9]+.[0-9]+.[0-9]+-rc.[0-9]+

jobs:
  tag-env:
    runs-on: ubuntu-latest
    steps:
      - name: Get build envirinment
        if: github.event_name == 'push'
        id: build
        run: |
          tag=${{ github.ref_name }}
          if [[ $tag == *"-stg"* ]]; then
              echo "env=stg" >> $GITHUB_OUTPUT
          else
              echo "env=prd" >> $GITHUB_OUTPUT
          fi

      - name: Show env
        if: ${{ always() }}
        run: |
          echo ${{ steps.build.outputs.env }}
          echo ${{ steps.build.outputs.env || inputs.environment }}
